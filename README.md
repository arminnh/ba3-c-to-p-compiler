## Compilers: A C-to-P-Compiler

_Project for the [Compilers](https://www.uantwerpen.be/popup/opleidingsonderdeel.aspx?catalognr=1001WETTEL&taal=en&aj=2015) course at the University of Antwerp._

### Requirements

*   Python 3

### Usage

Unix: (from c2p/src)

*   **./build.sh**  
    generates files which are necessary for building our AST, using the antlr4 jar file in src/
*   **./test.sh**  
    runs the unit tests in c2p/src/tests/
    tests can also be ran from c2p/src/tests/ with "python3 main.py".
    If not all necessary files generated by antlr are present, this script will first run the build script.
*   **python3 c2p.py filename**  
    This will take a .c file _filename_, parse it, and do scope checking and type checking. A textual representation of an AST will be printed, as well as the symbol table, which represents identifiers and their types in different scopes.
    If any syntactic or semantical errors are recognized in the .c file, they will be printed.

Windows: (from c2p/ or c2p/src)

*   In the .bat scripts, Python 3 is executed with "python3".
*   **build** or build.bat
*   **test** or test.bat
*   **python3 c2p.py filename**

### Compilation Steps

The order of precedence of operators is respected by the grammar.

After the parsing of a .c file, an AST gets built using a listener.
Then, the AST is visited in-order and a symbol table is filled (this is the first pass). This table is used for scoping and type checking. If a variable or a function is used in a scope where it doesn't exist, an error is displayed.
In the second pass over the AST, type checking is performed:

*   For function calls, the types of the arguments must comply with the types of the parameters in the function's definition/declaration.
*   For binary operators, the types of both operands must be equal.
*   For logic operators, the type of the operands must equate to "int".
    The return type of these operators is "int".
*   For the ternary conditional, the type first operand (which is the conditional) must equate to "int", and both alternatives should be of equal type.
*   For variable definitions, the type of the initializer must be compatible.

### Optional Features

The [grammar](src/SmallC.g4) recognizes all mandatory features, and some more:

*   const variables/parameters
*   binary operators <=, >=
*   unary operators ++, --, [ ]
*   array aggregate initialization
*   do while
*   multi-line comments

### Error messages

These messages can be generated during the filling of the symbol table or during type checking.

*   Function: Undefined reference
*   Function Definition: Parameter name omitted
*   Redefinition of function
*   Conflicting types for function definition (functionIdentifier)
*   Conflicting types for function declaration (functionIdentifier)
*   Function definition parameters don't match with previous declaration
*   Function declaration parameters don't match previous definition
*   Function declaration parameters don't match previous declaration
*   Variable/Function Declaration/Definition: Identifier (identifier) already taken by variable
*   Variable Declaration/Definition: Identifier (identifier) already taken by function
*   Variable (variableIdentifier) used before it was declared
*   Function (functionIdentifier) used before it was declared
*   Redefinition of main


*   Variable initialization must have the same type (have type1 and type2)
*   Function call: Number of arguments to function (functionIdentifier) does not match definition (have type1, need type2)
*   Function call: Arguments to function (functionIdentifier) don't match: type1 vs type2"
*   Binary operator operands must have the same type (have type1 and type2)
*   Ternary conditional operator needs int as first operand
*   Ternary conditional operator alternatives should be of equal type
*   Logic operator operands must have the same type (have type1 and type2)
*   Logic operator operands not compatible with int
*   Comparison operator operands need to be of same type (have type1 and type2)
*   invalid type argument of unary '\*' (have type1)
*   Logical not operator operand not compatible with int

### Classes

*   [AbstracSyntaxTree.py](images/AST-and-nodes.png) (large image): AbstracSyntaxTree and tree node classes, these build the AST we use.
*   [MyListener.py](images/MyListener.png): A listener which can build an AST when walking over a parse tree generated by SmallCParser.
*   [TypeInfo.py](images/TypeInfo.png): A class that contains information about the type of a variable or function.
*   [SymbolTable.py](images/SymbolTable.png): Our symbol table class which is used for scope and type checking.
*   [ASTSymbolTableFiller.py](images/ASTSymbolTableFiller.png): A class that fills in a symbol table
*   [CompilerErrorHandler.py](images/CompilerErrorHandler.png): A class in which errors generated in tree nodes, MyListener, ASTSymbolTableFiller or SymbolTable are collected. We use this to collect error and display them after/during compilation. It is also used to check errors in testing
*   [testfiles/main.py](images/testfiles-main.png): ASTTest and test classes, ASTTest provides the test classes with functions to test functionality easily


### Authors
* [Josse Coen](https://github.com/jsscn)
* [Armin Halilovic](https://github.com/arminnh)
